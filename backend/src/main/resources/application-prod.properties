# ========================================
# PRODUCTION PROFILE CONFIGURATION
# ========================================
# Activate with: --spring.profiles.active=prod
# or environment variable: SPRING_PROFILES_ACTIVE=prod

# ========================================
# DATABASE - Production PostgreSQL
# ========================================
# IMPORTANT: Set these via environment variables in production!
spring.datasource.url=${DATABASE_URL}
spring.datasource.username=${DATABASE_USER}
spring.datasource.password=${DATABASE_PASSWORD}

# Connection Pool Settings
spring.datasource.hikari.maximum-pool-size=20
spring.datasource.hikari.minimum-idle=5
spring.datasource.hikari.connection-timeout=30000
spring.datasource.hikari.idle-timeout=600000
spring.datasource.hikari.max-lifetime=1800000

# JPA Settings - Production (No SQL logging)
spring.jpa.show-sql=false
spring.jpa.properties.hibernate.format_sql=false
spring.jpa.hibernate.ddl-auto=validate
spring.jpa.open-in-view=false

# ========================================
# SECURITY - Strict for Production
# ========================================
# IMPORTANT: Set JWT_SECRET via environment variable!
jwt.secret=${JWT_SECRET}
jwt.expiration=${JWT_EXPIRATION:86400000}
jwt.refresh-expiration=${JWT_REFRESH_EXPIRATION:604800000}

# CORS - Production frontend URL only
cors.allowed-origins=${FRONTEND_URL}

# ========================================
# OAUTH2 - Production Credentials
# ========================================
spring.security.oauth2.client.registration.google.client-id=${GOOGLE_CLIENT_ID}
spring.security.oauth2.client.registration.google.client-secret=${GOOGLE_CLIENT_SECRET}
spring.security.oauth2.client.registration.github.client-id=${GITHUB_CLIENT_ID}
spring.security.oauth2.client.registration.github.client-secret=${GITHUB_CLIENT_SECRET}

# ========================================
# LOGGING - Minimal for Production
# ========================================
logging.level.root=WARN
logging.level.com.oneonline.backend=INFO
logging.level.org.springframework.security=WARN
logging.level.org.springframework.web=WARN
logging.level.org.hibernate.SQL=WARN

# Log to file in production
logging.file.name=/var/log/oneonline/application.log
logging.logback.rollingpolicy.max-file-size=10MB
logging.logback.rollingpolicy.max-history=30

# ========================================
# ERROR HANDLING - Minimal Info for Production
# ========================================
server.error.include-message=never
server.error.include-binding-errors=never
server.error.include-stacktrace=never
server.error.include-exception=false

# ========================================
# ACTUATOR - Limited Exposure for Production
# ========================================
management.endpoints.web.exposure.include=health,info,metrics
management.endpoint.health.show-details=when-authorized
management.metrics.export.prometheus.enabled=true

# ========================================
# SSL/TLS Configuration (if not handled by reverse proxy)
# ========================================
# server.ssl.enabled=true
# server.ssl.key-store=${SSL_KEY_STORE}
# server.ssl.key-store-password=${SSL_KEY_STORE_PASSWORD}
# server.ssl.key-store-type=PKCS12

# ========================================
# FLYWAY - Production
# ========================================
spring.flyway.enabled=true
spring.flyway.baseline-on-migrate=true
spring.flyway.clean-disabled=true
spring.flyway.validate-on-migrate=true

# ========================================
# SERVER CONFIGURATION
# ========================================
server.port=${PORT:8080}
server.compression.enabled=true
server.compression.mime-types=application/json,application/xml,text/html,text/xml,text/plain

# Shutdown gracefully
server.shutdown=graceful
spring.lifecycle.timeout-per-shutdown-phase=30s

# ========================================
# CACHE (if using Redis)
# ========================================
# spring.cache.type=redis
# spring.redis.host=${REDIS_HOST}
# spring.redis.port=${REDIS_PORT:6379}
# spring.redis.password=${REDIS_PASSWORD}
